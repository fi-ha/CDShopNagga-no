<!-- 未ログインの状態でカート追加、購入ボタンクリック時に表示 -->
<% if flash[:alert] %>
	<p><%= flash[:alert] %></p>
<% end %>

<div class="main">
	<div class="clearfix">
		<h1><%= @item.item_name %></h1>
		<div class="content-left">
			<%= attachment_image_tag @item,:image, :fill, 200, 200 %>
		</div>
		<div class="content-right">
			<strong>商品名：</strong><%= @item.item_name %><br>
			<strong>アーティスト名：</strong><% @item.singers.each do |singer| %>
				<%= singer.singer_name %><br>
			<% end %>
			<strong>ジャンル：</strong><% @item.genres.each do |genre| %>
				<%= genre.genre_name %><br>
			<% end %>
			<strong>レーベル名：</strong><%= @item.label.label_name %><br>
			<strong>価格(税込)：</strong><%= (@item.price*BigDecimal("1.08")).ceil %>円<br>
			<strong>在庫：</strong><%= @item.stock.stock_count %>点
		</div>
	</div>

	<section class="clearfix">
		<h2>収録曲</h2>
		<table>
			<tr>
				<td class="songs">DISC</td>
				<td class="songs">NUMBER</td>
				<td class="songs">SONG</td>
			</tr>
			<% @item.songs.each do |song| %>
				<tr>
					<td class="songs"><%= song.disk %></td>
					<td class="songs"><%= song.number %></td>
					<td class="songs"><%= song.song_name %></td>
				</tr>
			<% end %>
		</table>
	</section>
	<div class="clearfix">
		<% if @item.favorited_by?(current_user) %>
				<%= link_to 'お気に入り登録済み', item_favorites_path(@item), method: :delete, class: "btn bg-info" %><br>
		<% else %>
				<%= link_to 'お気に入り登録する', item_favorites_path(@item), method: :post, class: "btn bg-info" %><br>
		<% end %>
			<%= link_to 'カートに追加する', carts_path(item_id: @item.id), method: :post, class: "btn bg-warning" %><br>
			<%= link_to '購入', carts_path(item_id: @item.id), method: :post, class: "btn bg-success" %><br>
			<%= link_to 'レビューを投稿する', new_item_reviews_path(@item.id), class: "btn bg-danger" %>
	</div>

<%= form_for [@item, @review] do |f| %>
	<p>レビュー</p>
	<%= f.text_area :body %>
	<%= f.submit '投稿' %>
<% end %>
	<!-- 商品に基づいたレビューを一覧表示させる -->
	<table class="">
		<tr>
			<td>投稿者</td>
			<td>レビュー</td>
			<td></td>
			<td></td>
		</tr>
		<% @item.reviews.each do |review| %>
		<tr>
			<td>
				<%= review.user.last_name %>
				<%= review.user.first_name %>
			</td>
			<td>
				<%= review.body %>
			</td>
			<!-- レビュー投稿ユーザーなら”編集”、”削除”を表示させる -->
			<% if review.user == current_user %>
				<td>
					<%= link_to "編集", edit_review_path(review.id), class: "btn btn bg-success" %>
				</td>
				<td>
					<%= link_to "削除", review_path(review.id), class: "btn btn bg-danger", method: :delete, "data-confirm" => "本当に削除しますか？" %>
				</td>
			<% else %>
				<td></td>
				<td></td>
			<% end %>
		</tr>
		<% end %>
	</table>
</div>